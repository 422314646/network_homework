<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>添加事务</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="style/adminStyle.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="./js/jquery.js"></script>
    <script type="text/javascript" src="./js/md5.js"></script>
    <script type="text/javascript" src="./config/utils.js"></script>
</head>
<body>
<div class="wrap" >
    <div class="page-title">
        <span class="modular fl"><i class="user"></i><em>添加事务</em></span>
    </div>
    <table class="noborder">
        <!-- <tr>
             <td style="text-align:right;">部门ID：</td>
             <td><input type="text" class="textBox length-middle" id="id"/></td>
         </tr>-->
        <tr>
            <td style="text-align:right;">事件类型：</td>
            <td><select type="text" class="textBox length-middle" id="type">
                    <option>1:违处信息</option>
                    <option>2:网络攻击</option>
                    <option>3:恶意软件</option>
                    <option>4:信息泄露</option>
                    <option>5:安全威胁/漏洞</option>
                </select>
            </td>
        </tr>
        <tr>
            <td style="text-align:right;">事务类型：</td>
            <td><select type="text" class="textBox length-middle" id="tranType">
                    <option>1:安全事件通报</option>
                    <option>2:热点事件发布</option>
                </select>
            </td>
        </tr>
        <tr>
            <td style="text-align:right;">辖区：</td>
            <td>
                <select type="text" class="textBox length-middle" id="handler_department" >
                </select>
            </td>
        </tr>
        <tr>
            <td style="text-align:right;">具体事件描述：</td>
            <td><textarea type="text" class="textBox length-middle" id="detail" ></textarea></td>
        </tr>
        <tr>
            <td style="text-align:right;"></td>
            <td><input type="button" class="tdBtn" value="保存"  onclick="buttonClick_search()"/></td>
        </tr>
    </table>
</div>

<script>
    $.ajax({
        type: "get",
        url: "/department",
        data: {page: 1, limit: 20, type: 3},
        success: function (result) {
            console.log(result);
            console.log(result.departments);
            for (i = 0; i < result.count; i++) {
                $("#handler_department").append("<option value=" + result.departments[i].id + ">" + result.departments[i].name + "</option>");
                $("#handler_department").append("<option value=" + result.departments[i].id + ">" + result.departments[i].name + "</option>");
            }
        }
    })
</script>


<script>
    function buttonClick_search(){
        // console.log("hello", document.getElementById("handler_department"));

        var res = confirm("确认提交");
        if(res == true){
            var params = {
                "type": parseInt(document.getElementById( "type").value),
                "detail": document.getElementById( "detail").value,
                "tranType": parseInt(document.getElementById("tranType").value),
                "handler_department": parseInt(document.getElementById("handler_department").value),

            };
                $.ajax({
                    type : "POST",  //提交方式
                    url : "/transaction",//路径
                    data: JSON.stringify(params),
                    success : function(result) {
                        console.log(result);
                        alert("添加成功");
                        parent.location.reload();
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.responseText);
                        var j = JSON.parse(XMLHttpRequest.responseText);
                        alert(j.error);
                    }
                });
        }
    }

</script>
</body>
</html>